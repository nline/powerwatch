Plugwatch G Firmware
====================

## Testing
- Sensing
  - [ ] GPS can get fix - gps_test
  - [ ] GPS PPS line pulses and can be read by particle and STM32 - 1/2 gps_test
    - The above to require better GPS soldering
  - [ ] Can still set accel Interrupt and read accel angle of board - accel_test
    - I think there is a soldering issue with current boards preventing this.
  - [ ] STM32 reads correct voltage out of HV amplifiers - stm_voltage_test
  - [ ] STM32 reads correct voltage out of LV amplifiers - stm_voltage_test
  - [x] Particle reads correct voltage out of HV amplifiers - particle_voltage_test
    - ~This is being weird. Specifically it works sometimes and doesn't work sometimes??~
    - ~I should ship back several full waveforms out of this amplifier to see what's up~
    - This was just being weird because my voltage sampling and mag algorithm isn't great
  - [x] Particle reads correct voltage out of LV amplifiers - particle_voltage_test
  - [ ] When HV is applied (i.e. 320VAC) HV amplifiers still work with resolution
  - [ ] When 800V voltage transient is applied detector triggers
  - [ ] STM32 can read voltage angle using PPS
- Communication
  - [x] Can connect and comm to particle cloud - any of the voltage tests
  - [x] STM32 and particle can communicate - stm_i2c_test
  - [x] Can read ID chip - id_chip_test
- Power
  - [x] 5V supplied when plugged into wall
  - [x] Battery charges in all states when wall powered
  - [ ] When battery drops below voltage thresh and no wall power particle in RST
  - [ ] When wall power particle never in reset (battery normal or low voltage)
  - [x] Particle can power on/off SD
  - [x] Particle can power on/off AC sensing + STM32 - stm_i2c_test
  - [x] Particle can power on/off GPS - gps_test
  - [x] Particle wakes up when wall power is applied - rtc_test
    - Currently only tested with USB, but should also be tested with actual wall power. Circuit is same though.
- Storage
  - [x] Can write to SD Card - sd_test
  - [x] Can read from SD Card - sd_test
- Time
  - [x] Write time to RTC - rtc_test
  - [x] Read time from RTC - rtc_test
  - [x] RTC maintains time after power off and on - rtc_test
  - [x] Can set timer on RTC that wakes up Particle (using particle wakeup circuit) - rtc_test
    - ~I think the timer driver has a bug?~ Fixed driver bug
- Programming
  - [x] Can Program STM32 and STM32 boots - stm_blink_test
  - [x] STM reset button works - stm_blink_test
- Other
  - [x] Particle can control RGB LED - led_test
  - [x] Particle can set brightness of RGB LED through brightness IC - led_test
  - [x] LEDs are same brightness when powered on - led_test
    - They are at least close? Maybe blue could be brighter?
  - [ ] ~Particle can deterministically hard reset itself (not in a loop) - particle_rst_test~
    - This does not WORK! Must switch to PIN D2 because there is a pull up on D3
  - [x] Watchdog triggers when not tickled - watchdog_test
  - [x] Watchdog doesn't trigger when tickled - watchdog_tickle_test

## Bugs and things to fix
 - Switch pins D2 and D3
 - STM LED doesn't work? Maybe soldering? Probably should be active low anyways
 - Possibly breakout UART from STM either to particle or just to somewhere for debugging.
 - Make AC wire holes bigger and further apart. Move big cap down towards GPS antenna so they have more room.
